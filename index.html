<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MY-ACE: Mid Yorkshire Anaesthetics and Critical Care Education</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
  />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-r from-sky-50 to-blue-100">

  <!-- Header -->
  <header class="bg-white shadow-md py-4">
    <nav class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
      <a class="text-2xl font-bold text-blue-800">MY‑ACE</a>
      <div class="hidden sm:flex space-x-4">
        <a href="mailto:adam.neep@nhs.net" class="text-gray-700 hover:text-blue-600 text-sm sm:text-base">Contact</a>
      </div>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="relative h-48 sm:h-64 md:h-80 flex items-center justify-center text-center text-white overflow-hidden bg-cover bg-center" 
           style="background-image: url('hero.jpg');">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative z-10 px-4 sm:px-6 bg-black/50 p-4 rounded-lg">
      <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2 leading-tight text-white">
        Mid Yorkshire Anaesthetics and Critical Care Education
      </h1>
      <p class="text-sm sm:text-base md:text-lg text-white">
        Inspiring Mastery Through Collaborative Education
      </p>
    </div>
  </section>

  <!-- CTA Buttons -->
  <section class="container mx-auto flex flex-col sm:flex-row items-center justify-center sm:space-x-4 space-y-4 sm:space-y-0 py-6 px-4 sm:px-6">
    <a href="https://docs.google.com/spreadsheets/d/1sUQkhwFnQ-5jRclmo527qooWOKm5hG3o4M_d9H94JN0/edit?usp=drivesdk" target="_blank"
      class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow text-center w-full sm:w-auto">Sign Up to Teach</a>

    <a href="https://forms.gle/ixQyoQEY2MhLuZpq6" target="_blank"
      class="px-6 py-3 bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-lg shadow text-center w-full sm:w-auto">Generate Certificate</a>

    <a href="/forms/"
      class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow text-center w-full sm:w-auto">Procedure Documentation</a>
  </section>


  <!-- Main Content -->
  <section class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row gap-y-6 lg:gap-y-0 lg:gap-x-8">
      <div class="flex-1">
        <h2 class="text-2xl sm:text-3xl font-bold text-blue-800 mb-1 leading-tight">
          Weekly Teaching Schedule
        </h2>
        <p class="text-sm text-gray-600 mb-6">
          Teaching starts at 12:30 online and in the ICU seminar room (unless otherwise specified)
        </p>
        <div id="content" class="flex flex-col gap-6 w-full">
          <div id="loading" class="flex justify-center items-center py-10">
            <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Side Column -->
      <aside class="w-full lg:w-1/4 bg-white rounded-lg shadow-md p-4 text-sm self-start space-y-6">
        <div class="border-l-4 border-blue-500 pl-3">
          <h3 class="text-lg font-semibold text-blue-700 mb-3">Joint ICU & Respiratory Teaching</h3>
          <ul class="list-disc list-inside text-gray-700 space-y-1">
            <li>12 Sept 2025 – A case of PJP pneumonia by Dr Mike Kitchen</li>
            <li>31 Oct 2025 - Topic TBC</li>
          </ul>
        </div>
        <div class="border-l-4 border-green-500 pl-3">
          <h3 class="text-lg font-semibold text-green-700 mb-3">Upcoming courses at Mid Yorks</h3>
          <ul class="list-disc list-inside text-gray-700 space-y-1">
            <li>EPIC II - 25 Sept 2025</li>
            <li>Yorkshire Difficult Airway - 26 Sep 2025</li>
            <li>Novice Critical Incident Course - 10 Oct 2025</li>
            <li>Novice Critical Incident Course - 17 Oct 2025</li>
            <li>MY RAG - 8 Nov 2025</li>
            <li>EPIC I - 23 Feb 2026</li>
            <li>YOR TRACH - 30 April 2026</li>
          </ul>
        </div>
        <div class="border-l-4 border-blue-500 pl-3">
          <h3 class="text-lg font-semibold text-blue-700 mb-3">Courses across Y&H</h3>
          <ul class="list-disc list-inside text-gray-700 space-y-1">
            <li>
              <a href="https://bookwhen.com/courses-calendar" target="_blank" class="text-blue-600 hover:underline">
                Visit the YAIRN Course Calendar for the full list of courses across the region
              </a>
            </li>
          </ul>
        </div>
      </aside>
    </div>
  </section>

  <!-- JavaScript -->
  <script>
    const API_URL = "https://opensheet.elk.sh/1sDtcdb8EzoWcLlKoXMwgguJr4o-4JjMpWHtKBZtfq6I/Sheet1";
    const contentDiv = document.getElementById("content");
    let cachedGroupedData = {};

    const teamsLinks = {
      Tuesday: "https://teams.microsoft.com/l/meetup-join/19%3ameeting_M2RmODI4YTctODM1ZC00MzExLTk0ZmItNzAyZmY5YTYzMmYy%40thread.v2/0?context=%7b%22Tid%22%3a%2237c354b2-85b0-47f5-b222-07b48d774ee3%22%2c%22Oid%22%3a%229689187b-18f9-48fb-a93f-bdcb92914f10%22%7d",
      Wednesday: "https://teams.microsoft.com/l/meetup-join/19%3ameeting_ZjY5YjdmMTUtYmEzZi00YjU3LWIyZGMtZTQ0NGRjZTdhMzA3%40thread.v2/0?context=%7b%22Tid%22%3a%2237c354b2-85b0-47f5-b222-07b48d774ee3%22%2c%22Oid%22%3a%229689187b-18f9-48fb-a93f-bdcb92914f10%22%7d",
      Thursday: "https://teams.microsoft.com/l/meetup-join/19%3ameeting_YjNjYzU4NDgtMmI2Yy00YzhjLWI2NjYtNmIwYjc1NmIzZGVi%40thread.v2/0?context=%7b%22Tid%22%3a%2237c354b2-85b0-47f5-b222-07b48d774ee3%22%2c%22Oid%22%3a%229689187b-18f9-48fb-a93f-bdcb92914f10%22%7d", // 
      Friday: "https://teams.microsoft.com/l/meetup-join/19%3ameeting_M2RmODI4YTctODM1ZC00MzExLTk0ZmItNzAyZmY5YTYzMmYy%40thread.v2/0?context=%7b%22Tid%22%3a%2237c354b2-85b0-47f5-b222-07b48d774ee3%22%2c%22Oid%22%3a%229689187b-18f9-48fb-a93f-bdcb92914f10%22%7d",
    };

    function formatDateDisplay(date) {
      return date.toLocaleDateString("en-GB", { day: "numeric", month: "long", year: "numeric" });
    }

    function formatDate(date) {
      return date.toISOString().split("T")[0];
    }

    function getMonday(date) {
      const d = new Date(date);
      d.setHours(0,0,0,0); // local midnight
      const day = d.getDay();
      const diff = day === 0 ? -6 : 1 - day; // Sunday = 0
      d.setDate(d.getDate() + diff);
      return d;
    }

    function getDayOfWeek(date) {
      return date.toLocaleDateString("en-US", { weekday: "long" });
    }

    function groupByWeek(data) {
      const grouped = {};
      const today = new Date();
      const thisMonday = getMonday(today);
      const nextMonday = new Date(thisMonday);
      nextMonday.setDate(nextMonday.getDate() + 7);

      data.forEach(entry => {
        if (!entry.date || !entry.name || !entry.topic) return;
        const entryDate = new Date(entry.date);
        if (isNaN(entryDate)) return;

        const entryMonday = getMonday(entryDate);
        // Only current week or next week
        if (entryMonday.getTime() !== thisMonday.getTime() &&
            entryMonday.getTime() !== nextMonday.getTime()) return;

        const weekKey = formatDate(entryMonday);
        if (!grouped[weekKey]) grouped[weekKey] = [];

        grouped[weekKey].push({
          date: formatDate(entryDate),
          dayOfWeek: getDayOfWeek(entryDate),
          name: entry.name,
          topic: entry.topic,
          notes: entry.notes || ""
        });
      });

      return grouped;
    }

    async function init() {
      const loading = document.getElementById("loading");
      loading.style.display = "flex";
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        loading.style.display = "none";
        contentDiv.innerHTML = "";

        const groupedData = groupByWeek(data);
        cachedGroupedData = groupedData;

        const weekKeys = Object.keys(groupedData).sort();
        if (weekKeys.length === 0) {
          contentDiv.innerHTML =
            '<p class="text-center text-gray-700">Teaching programme re-starts on the 13th January 2026, please continue to sign up for sessions by clicking the link above.</p>';
          return;
        }

        weekKeys.forEach(weekStart => {
          const sessions = groupedData[weekStart];
          const mondayOfWeek = new Date(weekStart);

          const section = document.createElement("div");
          section.className = "w-full bg-white border-l-4 border-blue-500 rounded-lg p-4 shadow-md";

          const heading = document.createElement("h3");
          heading.className = "text-lg font-semibold text-blue-800 mb-2";
          heading.textContent = `Week commencing ${formatDateDisplay(mondayOfWeek)}`;
          section.appendChild(heading);

          sessions.sort((a,b) => new Date(a.date) - new Date(b.date));
          sessions.forEach(session => {
            const { dayOfWeek, name, topic, notes } = session;
            const entry = document.createElement("div");
            entry.className = "mb-3 p-3 bg-blue-50 border border-blue-200 rounded";
            const teamsLink = teamsLinks[dayOfWeek];
            const linkButton = teamsLink ? `<a href="${teamsLink}" target="_blank" class="inline-block mt-2 text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Join ${dayOfWeek}</a>` : "";
            entry.innerHTML = `
              <p class="text-blue-900 font-bold">${dayOfWeek}</p>
              <p><strong>Topic:</strong> ${topic}</p>
              <p><strong>Presenter:</strong> ${name}</p>
              ${notes ? `<p class="text-sm text-gray-600 italic">${notes}</p>` : ""}
              ${linkButton}
            `;
            section.appendChild(entry);
          });

          contentDiv.appendChild(section);
        });

      } catch(e) {
        loading.style.display = "none";
        contentDiv.innerHTML = '<p class="text-red-600 text-center">Failed to load teaching sessions - please press refresh.</p>';
        console.error(e);
      }
    }

    function generateEmail() {
      const today = new Date();
      const thisMonday = getMonday(today);
      const nextMonday = new Date(thisMonday);
      nextMonday.setDate(nextMonday.getDate() + 7);

      const weekKey = formatDate(nextMonday);
      const sessions = cachedGroupedData[weekKey] || [];

      if (sessions.length === 0) {
        alert("No sessions scheduled for next week.");
        return;
      }

      const subject = encodeURIComponent("Next Week's Teaching Sessions");
      const signUpLink = "https://docs.google.com/spreadsheets/d/1sDtcdb8EzoWcLlKoXMwgguJr4o-4JjMpWHtKBZtfq6I/edit?usp=sharing";

      let body = `Hi everyone,%0D%0A%0D%0A`;
      body += `I hope you have had a great weekend. The schedule for this week's teaching is as follows:%0D%0A%0D%0A`;

      sessions.forEach(({ dayOfWeek, topic, name }) => {
        const link = teamsLinks[dayOfWeek] || "N/A";
        body += `${dayOfWeek}:%0D%0A  Topic: ${topic}%0D%0A  Presenter: ${name}%0D%0A  Link: ${link}%0D%0A%0D%0A`;
      });

      body += `Please continue to sign up to help teach on the programme: ${signUpLink}%0D%0A%0D%0A`;
      body += `All the best,%0D%0A%0D%0AAdam%0D%0A`;
      body += `%0D%0ADr Adam Neep%0D%0AConsultant in ICM and Anaesthesia%0D%0AGMC: 7135243`;

      const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
      window.location.href = mailtoLink;
    }

    document.addEventListener("dblclick", () => {
      const password = prompt("Please enter the password to email next week's schedule:");
      const correctPassword = "MySecret123";
      if (password === correctPassword) {
        generateEmail();
      } else {
        alert("Incorrect password.");
      }
    });

    init();
  </script>

  
  
</body>
</html>
