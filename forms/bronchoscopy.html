<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bronchoscopy Checklist Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">

  <div class="max-w-4xl mx-auto bg-white shadow p-6 rounded">
    <h1 class="text-3xl font-bold mb-6">Bronchoscopy Checklist + Clinical Note Generator</h1>

    <!-- Free text fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <label class="font-medium">Procedure Date:</label>
        <input type="date" id="proc_date" class="w-full border p-2 rounded">
      </div>
      <div>
        <label class="font-medium">Time:</label>
        <input type="text" id="proc_time" class="w-full border p-2 rounded">
      </div>
      <div>
        <label class="font-medium">Operator:</label>
        <input type="text" id="operator" class="w-full border p-2 rounded">
      </div>
      <div>
        <label class="font-medium">Assistant:</label>
        <input type="text" id="assistant" class="w-full border p-2 rounded">
      </div>
      <div>
        <label class="font-medium">Supervisor:</label>
        <input type="text" id="supervisor" class="w-full border p-2 rounded">
      </div>
    </div>

    <!-- SIGN IN / BEFORE THE PROCEDURE -->
    <h2 class="text-xl font-bold bg-red-600 text-white p-2 mt-4">BEFORE THE PROCEDURE</h2>
    <div class="grid grid-cols-1 gap-4 mt-4">

      <div>
        <div class="font-medium">Patient identity checked?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="identity" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Appropriate consent completed?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="consent" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Is Equipment available for bronchoscopy and re-intubation?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="equipment" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Intubation grade known?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="linetype" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Should the procedure be delayed for medical optimisation? Consider stability, ventilator pressures, FiO2, anatomical issues</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="coag" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="coag" value="No" onchange="onlyOne(this)"> No</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Is there coagulopathy? (drugs and lab tests)</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="allergies" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="allergies" value="No" onchange="onlyOne(this)"> No</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Known drug allergies?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="infection" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="infection" value="No" onchange="onlyOne(this)"> No</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Has enteral feed been stopped and NG tube aspirated?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="help" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="help" value="No" onchange="onlyOne(this)"> No</label>
        </div>
      </div>

    </div>

    <!-- TIME OUT -->
    <h2 class="text-xl font-bold bg-yellow-400 text-black p-2 mt-8">TIME OUT</h2>
    <div class="grid grid-cols-1 gap-4 mt-4">

      <div>
        <div class="font-medium">Is patient on adequate ventilator settings and 100% FiO2</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="teamroles" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Is patient adequately sedated and paralysed</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="position" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

    </div>

    <!-- SIGN OUT -->
    <h2 class="text-xl font-bold bg-green-600 text-white p-2 mt-8">SIGN OUT</h2>
    <div class="grid grid-cols-1 gap-4 mt-4">

      <div>
        <div class="font-medium">Ventilator settings reviewed post procedure?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="aspirate" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Is a CXR required?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="caps" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="caps" value="No" onchange="onlyOne(this)"> No</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Sedation plan post procedure</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="dressing" value="Yes" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Samples taken and plan for labelling/lab delivery?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="guidewire_removed" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="guidewire_removed" value="N/A" onchange="onlyOne(this)"> Yes</label>
        </div>
      </div>

      <div>
        <div class="font-medium">Any findings that require follow up?</div>
        <div class="flex gap-4 mt-1">
          <label><input type="checkbox" name="cxr_required" value="Yes" onchange="onlyOne(this)"> Yes</label>
          <label><input type="checkbox" name="cxr_required" value="No" onchange="onlyOne(this)"> N/A</label>
        </div>
      </div>

    </div>

 <!-- PROCEDURE DETAILS -->
<div class="bg-purple-600 text-white font-bold text-lg px-4 py-2 rounded mt-6">
  PROCEDURE DETAILS
</div>

<div class="mt-4 space-y-4">

  <!-- Indication -->
  <div>
    <div class="font-medium">Indication for bronchoscopy:</div>
    <input type="text" id="indication_bronch" class="border p-2 rounded w-full">
  </div>

  <!-- Route -->
  <div>
    <div class="font-medium">Route:</div>
    <div class="flex gap-4 mt-1">
      <label><input type="checkbox" name="route" value="ETT" onchange="onlyOne(this)"> ETT</label>
      <label><input type="checkbox" name="route" value="Tracheostomy" onchange="onlyOne(this)"> Tracheostomy</label>
      <label><input type="checkbox" name="route" value="Oral" onchange="onlyOne(this)"> Oral</label>
    </div>
  </div>

  <!-- Sedation / anaesthesia -->
  <div>
    <div class="font-medium">Sedation / anaesthesia details:</div>
    <input type="text" id="sedation_details" class="border p-2 rounded w-full">
  </div>

  <!-- Complications -->
  <div>
    <div class="font-medium">Complications:</div>
    <input type="text" id="complications" class="border p-2 rounded w-full">
  </div>
  
<!-- Lung segments diagram -->
  <div>
    <div class="font-medium mb-2">Lung segments reference:</div>
    <img src="2-Figure1-1.png" alt="Lung segments diagram" class="w-full rounded border">
    <p class="text-sm text-gray-200 mt-1">Reference diagram for lung segments</p>
  </div>

  
  <!-- Findings -->
  <div>
    <div class="font-medium">Findings:</div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-1">
      <div>
        <div class="font-medium">Left lung:</div>
        <input type="text" id="findings_left_upper" placeholder="Upper lobe" class="border p-2 rounded w-full mb-1">
        <input type="text" id="findings_left_lower" placeholder="Lower lobe" class="border p-2 rounded w-full">
      </div>
      <div>
        <div class="font-medium">Right lung:</div>
        <input type="text" id="findings_right_upper" placeholder="Upper lobe" class="border p-2 rounded w-full mb-1">
        <input type="text" id="findings_right_middle" placeholder="Middle lobe" class="border p-2 rounded w-full mb-1">
        <input type="text" id="findings_right_lower" placeholder="Lower lobe" class="border p-2 rounded w-full">
      </div>
    </div>
  </div>

  <!-- Samples -->
  <div>
    <div class="font-medium">Details of samples sent to lab and tests requested:</div>
    <input type="text" id="samples_lab" class="border p-2 rounded w-full">
  </div>

</div>

    <!-- GENERATE BUTTON -->
    <button onclick="generateNote()"
            class="mt-8 bg-blue-600 text-white px-4 py-2 rounded">
      Generate Text Note
    </button>

    <!-- OUTPUT -->
 <div class="mt-6">
  <textarea id="output" class="w-full h-80 border p-3 rounded font-mono"
            readonly></textarea>

  <div class="flex flex-col md:flex-row md:items-center md:gap-4 mt-3">
    <button onclick="copyText()" class="bg-green-600 text-white px-4 py-2 rounded w-full md:w-auto">
      Copy to Clipboard
    </button>

    <p class="text-gray-700 text-sm mt-2 md:mt-0">
      Paste these notes into the patient PPM record, set title as <strong>"Bronchoscopy"</strong>.
    </p>
  </div>
</div>

    </div>

  </div>

<script>
// enforce Yes/No/N/A exclusivity
function onlyOne(checkbox) {
  const group = document.getElementsByName(checkbox.name);
  group.forEach(box => {
    if (box !== checkbox) box.checked = false;
  });
}

// get selected checkbox value
function getValue(name) {
  const boxes = document.getElementsByName(name);
  for (let b of boxes) if (b.checked) return b.value;
  return "Not selected";
}

function generateNote() {
  let output = "BRONCHOSCOPY SAFETY CHECKLIST\n\n";
 
 // Procedure details
  let rawDate = document.getElementById('proc_date').value; // YYYY-MM-DD
  let ukDate = "Not selected";
  if (rawDate) {
    const parts = rawDate.split('-');
    ukDate = parts[2] + "/" + parts[1] + "/" + parts[0];
  }
  output += "=== PROCEDURE DETAILS ===\n";
  output += `Procedure Date: ${ukDate}\n`;
  output += `Time: ${document.getElementById('proc_time').value}\n`;
  output += `Operator: ${document.getElementById('operator').value}\n`;
  output += `Assistant: ${document.getElementById('assistant').value}\n`;
  output += `Supervisor: ${document.getElementById('supervisor').value}\n\n`;

  output += `• Indication for bronchoscopy: ${document.getElementById("indication_bronch").value}\n`;


// Route checkboxes
const routeBoxes = document.getElementsByName("route");
let route = "Not selected";
routeBoxes.forEach(b => { if (b.checked) route = b.value; });
output += `• Route: ${route}\n`;

output += `• Sedation/anaesthesia details: ${document.getElementById("sedation_details").value}\n`;
output += `• Complications: ${document.getElementById("complications").value}\n\n`;

// Findings
output += "FINDINGS\n";
output += "Left lung:\n";
output += `Upper lobe - ${document.getElementById("findings_left_upper").value}\n`;
output += `Lower lobe - ${document.getElementById("findings_left_lower").value}\n\n`;

output += "Right lung:\n";
output += `Upper lobe - ${document.getElementById("findings_right_upper").value}\n`;
output += `Middle lobe - ${document.getElementById("findings_right_middle").value}\n`;
output += `Lower lobe - ${document.getElementById("findings_right_lower").value}\n\n`;


output += `• Details of samples sent to lab/tests requested: ${document.getElementById("samples_lab").value}\n\n\n\n`;


  // BEFORE THE PROCEDURE
  output += "=== LocSSIP (Local Safety Standards for Invasive Procedures) checklist ===\n\n";
  output += "=== BEFORE THE PROCEDURE ===\n";
  output += `• Patient identity checked: ${getValue("identity")}\n`;
  output += `• Consent completed: ${getValue("consent")}\n`;
  output += `• Equipment available: ${getValue("equipment")}\n`;
  output += `• Intubation grade known: ${getValue("linetype")}\n`;
  output += `• Procedure delay for optimisation: ${getValue("coag")}\n`;
  output += `• Coagulopathy: ${getValue("allergies")}\n`;
  output += `• Drug allergies: ${getValue("infection")}\n`;
  output += `• Enteral feed/NG aspirated: ${getValue("help")}\n\n`;

  // TIME OUT
  output += "=== TIME OUT ===\n";
  output += `• Adequate ventilator/FiO2: ${getValue("teamroles")}\n`;
  output += `• Patient sedated/paralysed: ${getValue("position")}\n\n`;

  // SIGN OUT
  output += "=== SIGN OUT ===\n";
  output += `• Ventilator settings reviewed: ${getValue("aspirate")}\n`;
  output += `• CXR required: ${getValue("caps")}\n`;
  output += `• Sedation plan post procedure: ${getValue("dressing")}\n`;
  output += `• Samples taken/labelling plan: ${getValue("guidewire_removed")}\n`;
  output += `• Follow-up findings: ${getValue("cxr_required")}\n\n`;


  document.getElementById("output").value = output;
}

function copyText() {
  navigator.clipboard.writeText(document.getElementById("output").value);
}

// Set default date
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('proc_date').value = new Date().toISOString().split('T')[0];
});
</script>

</body>
</html>
